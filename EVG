#!/bin/bash
# EVG â€” Ez Graphics Module
# For terminal canvas drawing

# -------------------------------
# Variables
# -------------------------------
declare -A CANVAS
CANVAS_WIDTH=0
CANVAS_HEIGHT=0

# -------------------------------
# Create canvas
# -------------------------------
Canvas() {
    CANVAS_WIDTH="$1"
    CANVAS_HEIGHT="$2"
    for ((y=0;y<CANVAS_HEIGHT;y++)); do
        for ((x=0;x<CANVAS_WIDTH;x++)); do
            CANVAS["$x,$y"]=" "
        done
    done
}

# -------------------------------
# Draw rectangle
# -------------------------------
Rect() {
    local x="$1"
    local y="$2"
    local w="$3"
    local h="$4"
    local char="${5:-#}"

    for ((i=0;i<w;i++)); do
        for ((j=0;j<h;j++)); do
            if (( x+i < CANVAS_WIDTH && y+j < CANVAS_HEIGHT )); then
                CANVAS["$((x+i)),$((y+j))"]="$char"
            fi
        done
    done
}

# -------------------------------
# Draw line (Bresenham)
# -------------------------------
Line() {
    local x0="$1"
    local y0="$2"
    local x1="$3"
    local y1="$4"
    local char="${5:-*}"

    local dx=$(( x1 - x0 ))
    local dy=$(( y1 - y0 ))
    local abs_dx=${dx#-}
    local abs_dy=${dy#-}
    local sx=1
    local sy=1
    (( dx<0 )) && sx=-1
    (( dy<0 )) && sy=-1
    local err=$(( (abs_dx>abs_dy ? abs_dx : -abs_dy)/2 ))
    local e2

    while true; do
        if (( x0 < CANVAS_WIDTH && y0 < CANVAS_HEIGHT )); then
            CANVAS["$x0,$y0"]="$char"
        fi
        (( x0==x1 && y0==y1 )) && break
        e2=$err
        (( e2 > -abs_dx )) && { err=$(( err - abs_dy )); x0=$(( x0 + sx )); }
        (( e2 < abs_dy )) && { err=$(( err + abs_dx )); y0=$(( y0 + sy )); }
    done
}

# -------------------------------
# Render canvas
# -------------------------------
Render() {
    for ((y=0;y<CANVAS_HEIGHT;y++)); do
        line=""
        for ((x=0;x<CANVAS_WIDTH;x++)); do
            line+="${CANVAS["$x,$y"]}"
        done
        echo "$line"
    done
}
